sudo: required
dist: trusty
language: cpp
cache: ccache

matrix:
  include:
    - os: linux
      env: QT=qt59

install:
  - export APP_REV=2077
  - export TRANS_REV=362
  - export ROOT_DIR=$PWD
  - sudo apt-get -qq update;
  - sudo apt-get -qq install po4a;
  - if [[ "$QT" == "qt59" ]]; then
        sudo apt-add-repository -y ppa:beineri/opt-qt593-trusty;
        sudo apt-get update -qq;
        sudo apt-get install -qq qt59tools;
    fi

script:
  - LCONVERT="lconvert"
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
         if [[ "$QT" == "qt59" ]]; then
             LCONVERT="/opt/qt59/bin/qmake";
         fi
    fi
  - wget "https://bazaar.launchpad.net/~adamreichold/qpdfview/trunk/tarball/$APP_REV"
  - wget "https://bazaar.launchpad.net/~adamreichold/qpdfview/translations-export/tarball/$SRC_REV"
  - tar -xvf $APP_REV
  - tar -xvf $SRC_REV
  - mv scripts \~adamreichold/qpdfview/
  - cd \~adamreichold/qpdfview/
  - cd scripts
  - sh convert_help.sh
  - sh convert_translation.sh
  - cd ../trunk
  - tar -zcvf qpdfview-$SRC_REV_$TRANS_REV.tar.gz .
  - ccache --show-stats

deploy:
  provider: releases
  api_key:
    secure: "vG3PnIRC0n0PZAwZ5zCpSj5JzrUqAwz+mcJPEZuBwnimN0XllV/NKhEUcid4WCMwTXnMy8Vxb/dB3v0xu0eSzdpE9GM7z4yNU9kitW5nPEkXl3CdCWTD16TFP70z3485D6YxngdeDu66kUzws7rUGwNB+SxoUK973gfD+89K2tIXhskow+F8h68AaES6rSEG15pWd1a1JLRNlU25N2dEsbuLG3aUBFJ5SbQMEML/cWbt5cLzmTXONwRKH0GSOL5k05lYQEUt11RGKVM/mnaYyRswEINove9EOSe2GujlnwGdgFxxg7V/xLx9CXAnwmnceqjSsO/4AwcFRuYn9CCyVzC1U68V17lKu44ImotYLlELZbs58GWz6qUVpjRw/pRBg0AX3mRu0gU9X+hkvvulUvTvVCYP204gJLPN9tchsPBFvNgr1GgjgRubCFRz9VpVdNNZcETn3q4t/RoNsfjzHL1QGjaWzKkTQ3clxLnhhRmGYZnacdcSkswRYWsOrvbonhiibqnnQWt1PuB+TebymSE/peDykwt4AHqkmgIxp0MeBF9U4XWMm0Bzy6h1BL3Ve50j37KMKP2HMVhxjbqpUkTiAX1Kr3azhNs27MjqOskaTpVCuytLG/HOPsN3Hvr67HAtOK+YkBp2gaAYyyB/KyOQnBtXGurKUd9yHmLXdic="
  file: $ROOT_DIR/\~adamreichold/qpdfview/qpdfview-$SRC_REV_$TRANS_REV.tar.gz
  skip_cleanup: true
